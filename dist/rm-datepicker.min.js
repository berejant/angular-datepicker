/*!
 * RM-DATEPICKER v1.0.0
 * http://rubymage.com
 *
 * Copyright 2015 Sergiu Ghenciu, RUBYMAGE
 * Released under the MIT license
 * https://github.com/RUBYMAGE/angular-datepicker/blob/master/LICENSE
 */
!function(){var e=angular.module("rmDatepicker",[]);e.constant("rmDatepickerConfig",{mondayStart:!1,textToday:"Today",initState:"month",maxState:"decade",minState:"month",toggleState:!0,decadeSize:12,monthSize:42,min:null,max:null,"default":new Date,activeMonthFormat:"LLLL yyyy",format:"yyyy-MM-dd"}),e.directive("rmDatepicker",["rmDatepickerConfig","$compile","$filter","$document","$timeout",function(e,t,a,i,r){var o=function(o,l,c,f){var u=angular.copy(e),d=function(){var e=new Date(u["default"].getTime());return e.isDefault=!0,e};o.isDefault=!0;var m=d(),g=function(e){return e.isDefault?o.isDefault=!0:o.val=e,m=e},v=function(){return o.isDefault};o.getDate=function(){return m};var D=function(e){if(e){for(var t in u)u.hasOwnProperty(t)&&void 0!=e[t]&&(u[t]=e[t]);u.min&&u.min.setHours(0,0,0,0),u.max&&u.max.setHours(23,59,59,999),u.min&&u["default"]<u.min&&(u["default"]=new Date(u.min.getTime())),u.max&&u["default"]>u.max&&(u["default"]=new Date(u.max.getTime())),u["default"].setHours(3,0,1,0),v()&&g(d()),p&&(f.$viewValue=m,f.$validate(),f.$invalid&&(o.isDefault=!0,f.$viewValue=g(d()),o.state=u.initState,f.$validate())),S&&S()}};o.$watch("rmConfig",D,!0),D(o.rmConfig);var p="INPUT"==l[0].tagName.toUpperCase(),h={min:!1,max:!1},y=function(e,t){return new Date(e,t+1,0).getDate()},w=function(e){var e=parseInt(e,10);if(!isNaN(m)){var t=y(m.getFullYear(),m.getMonth());e<1&&(e=1),e>t&&(e=t),m.setDate(e)}},x={decade:function(e){var t,a=e.getFullYear(),i=e.getMonth(),r=e.getDate(),o=0,s=u.min?u.min.getFullYear():0;n=u.decadeSize||12;var l=new Array(n);for(a=Math.floor((a-s)/n)*n+s;o<n;a++,o++)t=y(a,i),r>t&&(r=t),l[o]=new Date(a,i,r,3,0,1,0);return l},year:function(e){for(var t,a=e.getFullYear(),n=0,i=e.getDate(),r=[];n<12;n++)t=y(a,n),i>t&&(i=t),r.push(new Date(a,n,i,3,0,1,0));return r},month:function(e){var t,a=e.getFullYear(),n=e.getMonth(),i=new Date(a,n,1,3,0,1,0),r=i.getDay()||7;return o.mondayStart&&(r=r-1||7),t="auto"==u.monthSize?r+y(a,n)<35?35:42:u.monthSize,i.setDate(-r+1),x.dates(i,t)},dates:function(e,t){for(var a=new Array(t),n=new Date(e),i=0;i<t;)a[i++]=new Date(n),n.setDate(n.getDate()+1);return a}},S=function(e){if(e=e||o.state,o.aDates=x[e](m),u.min&&(h.min=o.aDates[0]<u.min),u.max){var t=o.aDates[o.aDates.length-1];h.max=t>u.max}},k=function(e,t){return"decade"==o.state?e.getFullYear()<t.getFullYear():"year"==o.state?e.getFullYear()==t.getFullYear()?e.getMonth()<t.getMonth():e.getFullYear()<t.getFullYear():e<t};o.isOff=function(e){return!(!u.min&&!u.max)&&(!(!u.min||!k(e,u.min))||(!(!u.max||!k(u.max,e))||void 0))},o.isActive={year:function(e){return e.getFullYear()==m.getFullYear()},month:function(e){return e.getMonth()==m.getMonth()},date:function(e){return e.getDate()==m.getDate()}},o.isToday=function(e){return o.isActive.date(e)&&o.isActive.month(e)&&o.isActive.year(e)},o.go=function(e){if(!o.isOff(e)){p&&o.state==u.minState&&o.isActive.month(e)&&F(!1);var t=m.getMonth();g(e),o.state==u.minState&&(o.isDefault=!1,p&&r(function(){f.$setViewValue(e),g(e)})),u.toggleState&&o.toggleState(1),t!=m.getMonth()&&S()}},o.now=function(){o.isDefault=!1,g(new Date),S()},o.next=function(e){if(e=e||1,e>0){if(h.max)return}else if(h.min)return;var t=m.getFullYear(),a=m.getMonth(),n=m.getDate();switch(o.state){case"decade":e*=o.aDates.length;case"year":m.setFullYear(t+e,a,15),w(n);break;case"month":m.setMonth(a+e,15),w(n);break;case"week":m.setDate(n+7*e)}S()},o.prev=function(e){return o.next(-e||-1)},o.toggleState=function(e){e=e||1,o.state==u.maxState&&e==-1||o.state==u.minState&&1==e||(o.state=o.aStates[o.aStates.indexOf(o.state)+e],S())},o.mondayStart=u.mondayStart,o.textToday=u.textToday,o.aStates=["decade","year","month"],o.state=u.initState,o.activeDateTpl={decade:"{{aDates[0].getFullYear()}} - {{aDates[aDates.length-1].getFullYear()}}",year:"{{getDate().getFullYear()}}",month:"{{getDate()| date: '"+u.activeMonthFormat.replace("'","")+"'}}",week:"{{getDate() | date: 'd MMMM yyyy' }}"};var $=function(e){e!=m&&(!e||e instanceof Date||(e=new Date(e)),e instanceof Date&&("Invalid Date"==e.toString()||e.isDefault)&&(e=null),e instanceof Date&&((!u.min||u.min<e)&&(!u.max||e<u.max)?(o.isDefault=!1,e.setHours(3,0,1,0),g(e)):o.isDefault||g(d()),p&&(f.$setViewValue(e),f.$viewValue=f.$formatters.reduceRight(function(e,t){return t(e)},e),f.$render())),S())},M=function(e){var t=0,a=0;if(e.offsetParent)do t+=e.offsetLeft,a+=e.offsetTop;while(e=e.offsetParent);return{top:a,left:t}},F=function(e){b.css("display",e?"block":"none"),A.css("display",e?"block":"none")},Y=function(e,t){var a=window.scrollX,n=window.scrollY,i=window.innerWidth,r=window.innerHeight;if(window.innerWidth<481)return{top:n,left:0};var o=n+r-e.top-t.clientHeight,s=a+i-e.left-t.clientWidth;return o<0&&(e.top+=o),e.top<n&&(e.top=n),s<0&&(e.left+=s),e.left<0&&(e.left=0),e};if(p){var T=function(e){return 4==e.length||2==e.length&&e>=40};f.$parsers.push(function(e){if(!e)return null;if(e instanceof Date)return e;var t=e.trim().split(/[^0-9]+/);if(3==t.length){if(T(t[0])){if(T(t[2]))return;t.reverse()}else if(!T(t[2]))return;var a=parseInt(t[2]);if(a&&!(a<1900)){var n=parseInt(t[1]);if(!(!n||n<1||n>12)){var i=parseInt(t[0]);if(!(!i||i<1||i>31)){var r=new Date(a,n-1,i,3,0,1,0);return(!u.min||u.min<r)&&(!u.max||r<u.max)?r:void 0}}}}}),f.$formatters.push(function(e){return v()?"":a("date")(e,u.format)}),f.$validators.required=function(){return console.log($scope.val,v()),!c.required||!v()},f.$validators.range=function(){return v()||(!u.min||u.min<m)&&(!u.max||m<u.max)};var b=angular.element('<div class="rm-overlay" style="display:none"></div>');b.on("click",function(){F(!1)}),i.find("body").eq(0).append(b),b.after(t(s)(o));var A=b.next();A.css({display:"none"}),A.addClass("it-is-input"),l.on("click focus",function(){if(!l.prop("readonly")){window.innerWidth<481&&l[0].blur();var e=M(l[0]);e.top+=l[0].offsetHeight+1,A.css({top:e.top+"px",left:e.left+"px",display:"block"}),F(!0),e=Y(e,A[0]),A.css({top:e.top+"px",left:e.left+"px"})}}),i.on("keydown",function(e){[9,13,27].indexOf(e.keyCode)>=0&&F(!1)}),o.$on("$destroy",function(){A.remove(),b.remove()})}else l.append(t(s)(o));o.$watch("val",$),$(o.val)},s='<div class="rm-datepicker" ng-class="{mondayStart: mondayStart}"><div class="nav"><a><i class="mi_arrow_back" ng-hide="state == \'decade\'"></i></a><a class="back waves-effect" ng-click="toggleState(-1)" rm-include="activeDateTpl[state]"></a><a class="adjacent waves-effect" ng-click="prev()"><i class="mi_keyboard_arrow_up"></i></a><a class="adjacent waves-effect" ng-click="next()"><i class="mi_keyboard_arrow_down"></i></a><a class="today waves-effect" ng-click="now()">{{textToday}}</a></div><div class="body" ng-include="\'rm-\' + state + \'.html\'"></div></div>';return{require:"ngModel",scope:{val:"=ngModel",rmConfig:"=rmConfig"},link:o}}]),e.run(["$templateCache",function(e){e.put("rm-decade.html",'<div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.year(oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'yyyy\'}}</span></a></div></div>'),e.put("rm-year.html",'<div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.month(oDate), off: isOff(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate | date: \'LLLL\'}}</span></a></div></div>'),e.put("rm-month.html",'<div class="day sunSat"><a ng-repeat="oDate in aDates | limitTo:7">{{oDate | date: \'EEE\'}}</a></div><div class="ng-class: state; square date"><div ng-repeat="oDate in aDates" ng-class="{j: !isDefault && isActive.date(oDate), off: isOff(oDate), out: !isActive.month(oDate)}"><a ng-click="go(oDate)" class="waves-effect"><span>{{oDate.getDate()}}</span></a></div></div>')}]),e.directive("rmInclude",["$compile",function(e){var t=function(t,a,n){t.$watch(function(e){return e.$eval(n.rmInclude)},function(n){a.html(n),e(a.contents())(t)})};return{restrict:"A",link:t}}])}();